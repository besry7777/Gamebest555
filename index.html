<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PARTY GAME: ONLY GAMES EDITION</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;800&display=swap" rel="stylesheet">
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

<style>
/* ================= CSS (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° 100%) ================= */
:root {
    --bg-color: #121212;
    --card-bg: #1e1e1e;
    --primary: #00e676;
    --text-main: #ffffff;
    --text-muted: #b0b0b0;
    --danger: #ef5350;
    --warning: #ffca28;
    --radius: 16px;
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    font-family: 'Sarabun', sans-serif;
    touch-action: manipulation; 
}

body {
    background-color: var(--bg-color);
    color: var(--text-main);
    margin: 0;
    padding: 0;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#game-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    padding: 16px;
    position: relative;
    z-index: 1;
}

header {
    flex: 0 0 auto;
    text-align: center;
    margin-bottom: 10px;
}

h1 {
    font-size: 1.8rem;
    margin: 0;
    font-weight: 800;
    letter-spacing: 1px;
    color: var(--primary);
    text-transform: uppercase;
}

.display-area {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: var(--card-bg);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid #333;
    position: relative;
    margin-bottom: 16px;
    overflow: hidden;
    min-height: 0;
}

.big-instruction {
    font-size: clamp(1.4rem, 5vw, 2.2rem);
    font-weight: 800;
    color: #fff;
    text-align: center;
    line-height: 1.4;
    width: 100%;
    word-wrap: break-word;
    z-index: 2;
    max-height: 60vh;
    overflow-y: auto;
}

.category-badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 15px;
    color: #000;
    opacity: 0;
    transition: opacity 0.3s;
}

.hint-text {
    margin-top: auto;
    padding-top: 15px;
    color: var(--text-muted);
    font-size: 0.8rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
.blur-anim { filter: blur(4px); opacity: 0.6; }

.controls-area {
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.btn {
    width: 100%;
    padding: 18px;
    font-size: 1.3rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 800;
    cursor: pointer;
    background-color: var(--primary);
    color: #000;
    transition: transform 0.1s;
}
.btn:active { transform: scale(0.97); }
.btn:disabled { background-color: #333; color: #555; cursor: not-allowed; }
.btn-secondary { background-color: #2c2c2c; color: #fff; font-size: 1rem; padding: 12px; }

#count-display {
    position: absolute; top: 10px; right: 10px;
    font-size: 0.75rem; color: #666; background: #111;
    padding: 4px 8px; border-radius: 6px;
}
#sound-toggle {
    position: absolute; top: 10px; left: 10px;
    background: transparent; color: #666; border: 1px solid #333;
    border-radius: 20px; padding: 4px 10px; font-size: 0.7rem; cursor: pointer;
}

/* Mini Games Area */
#special-game-area {
    margin-top: 15px;
    width: 100%;
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    border: 1px solid #444;
}

.game-btn {
    background: var(--danger);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    margin-bottom: 10px;
}

.skip-btn {
    background: transparent;
    border: 1px solid #666;
    color: #888;
    padding: 8px 16px;
    border-radius: 30px;
    font-size: 0.9rem;
    cursor: pointer;
    margin-top: 5px;
}

.timer-text {
    font-size: clamp(3rem, 10vw, 5rem);
    font-weight: 800;
    color: var(--danger);
    font-variant-numeric: tabular-nums;
    margin: 10px 0;
}

/* Wire Buttons for Bomb Game */
.wire-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    width: 100%;
}
.wire-btn {
    height: 60px;
    border-radius: 8px;
    border: 3px solid rgba(255,255,255,0.2);
    cursor: pointer;
    transition: all 0.2s;
}

/* Modal History */
.modal-overlay {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(3px);
    z-index: 100;
    display: flex; justify-content: center; align-items: flex-end;
    opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.active { opacity: 1; pointer-events: all; }
.modal-content {
    background: #252525;
    width: 100%; max-width: 500px; height: 70vh;
    border-radius: 20px 20px 0 0;
    display: flex; flex-direction: column;
    transform: translateY(100%); transition: transform 0.3s ease;
}
.modal-overlay.active .modal-content { transform: translateY(0); }
.modal-header {
    padding: 15px 20px; border-bottom: 1px solid #333;
    display: flex; justify-content: space-between; align-items: center;
}
.modal-header h2 { margin: 0; font-size: 1.2rem; color: #fff; }
.close-modal { background: none; border: none; color: #aaa; font-size: 1.5rem; }
.history-list { flex: 1; overflow-y: auto; padding: 0; margin: 0; list-style: none; }
.history-item {
    padding: 15px 20px; border-bottom: 1px solid #333;
    font-size: 0.9rem; display: flex; align-items: flex-start; color: #ddd;
}
.history-tag {
    font-size: 0.65rem; padding: 2px 6px; border-radius: 4px;
    margin-right: 8px; color: #000; font-weight: bold; white-space: nowrap; margin-top: 3px;
}

/* --- Camera Overlay --- */
#camera-overlay {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    z-index: 2000;
    display: none; 
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
#camera-video {
    position: absolute;
    width: 100%; height: 100%;
    object-fit: cover;
    opacity: 0.7;
}
#smile-ui-layer {
    position: relative; z-index: 2005;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    width: 100%; height: 100%;
    padding: 20px;
    text-align: center;
}
#smile-status {
    font-size: 1.5rem; font-weight: 800;
    color: #fff; text-shadow: 0 0 10px #000;
    margin-bottom: 20px;
}
#smile-timer {
    font-size: 5rem; font-weight: 800;
    color: #00e676;
    text-shadow: 0 0 20px #000;
    font-variant-numeric: tabular-nums;
}
.scanning-line {
    position: absolute; top: 0; left: 0; width: 100%; height: 5px;
    background: #00e676; box-shadow: 0 0 15px #00e676;
    z-index: 2001; animation: scan 2s infinite linear;
}
@keyframes scan { 0% { top: 0%; } 50% { top: 100%; } 100% { top: 0%; } }
.smile-detected {
    border: 10px solid #ef5350;
    box-shadow: inset 0 0 100px #ef5350;
}
@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    50% { transform: translate(-1px, 2px) rotate(1deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    100% { transform: translate(1px, -2px) rotate(0deg); }
}
.back-btn {
    background: #fff; color: #000;
    border: none; padding: 15px 30px;
    border-radius: 50px; font-size: 1.2rem;
    font-weight: bold; margin-top: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    display: none; cursor: pointer;
}
</style>
</head>

<body>

<div id="camera-overlay">
    <video id="camera-video" autoplay muted playsinline></video>
    <div class="scanning-line"></div>
    <div id="smile-ui-layer">
        <div id="smile-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î AI...</div>
        <div id="smile-timer">--</div>
        <button class="back-btn" onclick="closeCameraGame()">üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
</div>

<div id="game-container">
    <header>
        <h1>PARTY GAME</h1>
    </header>

    <div class="display-area">
        <button id="sound-toggle">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
        <div id="count-display"></div>

        <div id="category-badge" class="category-badge">CATEGORY</div>
        
        <div class="big-instruction" id="wheel-result">
            ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°?<br>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢!
        </div>

        <div id="special-game-area"></div>

        <div class="hint-text">MODE: ALL GAMES (NO QUESTIONS)</div>
    </div>

    <div class="controls-area">
        <button class="btn" id="spin-btn" onclick="startSpin()">üé≤ ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
        <button class="btn btn-secondary" onclick="openHistory()">üìú ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
    </div>
</div>

<div class="modal-overlay" id="historyModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô</h2>
            <button class="close-modal" onclick="closeHistory()">‚úï</button>
        </div>
        <ul class="history-list" id="historyListDisplay"></ul>
    </div>
</div>

<audio id="clickSound" src="https://www.soundjay.com/buttons/sounds/button-50.mp3"></audio>
<audio id="resultSound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>
<audio id="alarmSound" src="https://www.soundjay.com/misc/sounds/magic-chime-01.mp3"></audio>
<audio id="gunSound" src="https://www.soundjay.com/mechanical/sounds/gun-cocking-01.mp3"></audio>
<audio id="bangSound" src="https://www.soundjay.com/mechanical/sounds/explosion-01.mp3"></audio>

<script>
// =================== 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß) ===================

const gameList = [
    // --- ‡πÄ‡∏Å‡∏°‡πÄ‡∏î‡∏¥‡∏° ---
    { t: "‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 40 ‡∏ß‡∏¥! ‡πÉ‡∏Ñ‡∏£‡∏™‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏î‡∏ô", c: "QUIET GAME", color: "#ffca28", type: "timer", time: 40 },
    { t: "‡∏Å‡∏î‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ 5.00 ‡∏ß‡∏¥ (¬±0.10)", c: "SKILL", color: "#42a5f5", type: "stopwatch", target: 5.00, range: 0.10 },
    { t: "‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πÄ‡∏•‡πá‡∏ï! (‡∏™‡πà‡∏á‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ß‡∏ô)", c: "LUCK", color: "#ef5350", type: "roulette" },
    { t: "‡∏Å‡∏π‡πâ‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î! ‡∏ï‡∏±‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ú‡∏¥‡∏î...‡∏ï‡∏π‡πâ‡∏°", c: "BOMB", color: "#ef5350", type: "bomb" },
    { t: "‡∏à‡∏≥‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡πÅ‡∏°‡πà‡∏ô! ‡∏ú‡∏¥‡∏î‡∏î‡∏∑‡πà‡∏°", c: "MEMORY", color: "#ab47bc", type: "memory" },
    { t: "AI ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°! ‡∏´‡πâ‡∏≤‡∏°‡∏¢‡∏¥‡πâ‡∏° 10 ‡∏ß‡∏¥", c: "AI CHALLENGE", color: "#fff", type: "dontsmile" },
    
    // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà 1: ‡∏£‡∏±‡∏ß‡∏ô‡∏¥‡πâ‡∏ß ---
    { t: "‡∏ô‡∏¥‡πâ‡∏ß‡∏£‡∏±‡∏ß! ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 30 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô 5 ‡∏ß‡∏¥", c: "SPEED", color: "#ff4081", type: "clicker", target: 30, time: 5 },
    
    // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà 2: ‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≥ ---
    { t: "‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á! ‡πÄ‡∏•‡∏Ç‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡∏™‡∏π‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πà‡∏≥ ?", c: "HIGH-LOW", color: "#00e5ff", type: "highlow" }
];

// =================== 2. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö ===================
let availableQuestions = [...gameList]; // ‡πÉ‡∏ä‡πâ gameList ‡πÅ‡∏ó‡∏ô normalQuestions
let history = []; 
let soundEnabled = true;

const clickSound = document.getElementById("clickSound");
const resultSound = document.getElementById("resultSound");
const alarmSound = document.getElementById("alarmSound");
const gunSound = document.getElementById("gunSound");
const bangSound = document.getElementById("bangSound");
const soundToggle = document.getElementById("sound-toggle");

const resultDisplay = document.getElementById('wheel-result');
const spinBtn = document.getElementById('spin-btn');
const countDisplay = document.getElementById('count-display');
const categoryBadge = document.getElementById('category-badge');
const specialGameArea = document.getElementById('special-game-area');

// =================== 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å ===================

soundToggle.onclick = () => {
    soundEnabled = !soundEnabled;
    soundToggle.innerText = soundEnabled ? "üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á" : "üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
    soundToggle.style.opacity = soundEnabled ? "1" : "0.5";
};

function playSound(sound) {
    if (!soundEnabled) return;
    if (!sound.paused) {
        sound.pause();
        sound.currentTime = 0;
    }
    sound.play().catch(()=>{});
}

function updateCountDisplay() {
    countDisplay.innerText = "Game Mode";
}

updateCountDisplay();

function startSpin() {
    specialGameArea.style.display = 'none';
    specialGameArea.innerHTML = ''; 
    categoryBadge.style.opacity = '0';
    
    playSound(clickSound); 
    spinBtn.disabled = true;
    resultDisplay.classList.remove("pop-in");
    resultDisplay.classList.add("blur-anim");

    // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
    let shuffleInterval = setInterval(() => {
        const randomQ = gameList[Math.floor(Math.random() * gameList.length)];
        resultDisplay.innerText = randomQ.t;
    }, 50);

    setTimeout(() => {
        clearInterval(shuffleInterval);
        processResult();
    }, 1000);
}

function processResult() {
    // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ
    const selectedObj = gameList[Math.floor(Math.random() * gameList.length)];

    history.unshift(selectedObj);
    resultDisplay.classList.remove("blur-anim");
    resultDisplay.innerText = selectedObj.t;
    categoryBadge.innerText = selectedObj.c;
    categoryBadge.style.backgroundColor = selectedObj.color;
    categoryBadge.style.color = "#000"; 
    categoryBadge.style.opacity = '1';

    void resultDisplay.offsetWidth; 
    resultDisplay.classList.add("pop-in");
    playSound(resultSound);

    // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏Å‡∏°
    setupGame(selectedObj);
    updateCountDisplay();
}

// =================== 4. Logic Games ===================

async function setupGame(gameObj) {
    specialGameArea.style.display = 'flex';
    
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    if (gameObj.type === 'timer') setupTimerGame(gameObj.time);
    else if (gameObj.type === 'stopwatch') setupStopwatchGame(gameObj.target, gameObj.range);
    else if (gameObj.type === 'roulette') setupRouletteGame();
    else if (gameObj.type === 'bomb') setupBombGame();
    else if (gameObj.type === 'memory') setupMemoryGame();
    else if (gameObj.type === 'dontsmile') {
        specialGameArea.innerHTML = `<button class="game-btn" onclick="setupSmileGame()">üì∏ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏ö‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°</button>${getSkipButtonHTML()}`;
    }
    // ‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
    else if (gameObj.type === 'clicker') setupClickerGame(gameObj.target, gameObj.time);
    else if (gameObj.type === 'highlow') setupHighLowGame();
}

function skipGame() {
    clearInterval(window.currentInterval);
    if(window.clickTimeout) clearTimeout(window.clickTimeout);
    specialGameArea.style.display = 'none';
    spinBtn.disabled = false;
    playSound(clickSound);
}

function getSkipButtonHTML() {
    return `<button class="skip-btn" onclick="skipGame()">‚è≠ ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ</button>`;
}

// --- Game Logic ‡πÄ‡∏î‡∏¥‡∏° ---
function setupTimerGame(seconds) {
    specialGameArea.innerHTML = `<button class="game-btn" onclick="runTimer(${seconds})">‚è±Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (${seconds} ‡∏ß‡∏¥)</button>${getSkipButtonHTML()}`;
}
function runTimer(seconds) {
    let timeLeft = seconds;
    specialGameArea.innerHTML = `<div class="timer-text" id="game-timer">${timeLeft}</div>${getSkipButtonHTML()}`;
    window.currentInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('game-timer').innerText = timeLeft;
        if (timeLeft <= 5 && timeLeft > 0) playSound(clickSound);
        if (timeLeft <= 0) {
            clearInterval(window.currentInterval);
            document.getElementById('game-timer').innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!";
            playSound(alarmSound);
            spinBtn.disabled = false;
        }
    }, 1000);
}
function setupStopwatchGame(target, range) {
    specialGameArea.innerHTML = `<div style="margin-bottom:5px;">‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ: ${target.toFixed(2)}</div><button class="game-btn" id="stopwatch-btn" onclick="runStopwatch(${target}, ${range})">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°!</button>${getSkipButtonHTML()}`;
}
function runStopwatch(target, range) {
    let startTime = Date.now();
    specialGameArea.innerHTML = `<div class="timer-text" id="sw-display">0.00</div><button class="game-btn" onclick="stopStopwatch(this, ${target}, ${range})">üü• ‡∏´‡∏¢‡∏∏‡∏î!</button>${getSkipButtonHTML()}`;
    window.currentInterval = setInterval(() => {
        const elapsed = (Date.now() - startTime) / 1000;
        document.getElementById('sw-display').innerText = elapsed.toFixed(2);
    }, 30);
}
function stopStopwatch(btn, target, range) {
    clearInterval(window.currentInterval);
    const finalTime = parseFloat(document.getElementById('sw-display').innerText);
    const diff = Math.abs(finalTime - target);
    if (diff <= range) { btn.innerText = "üéâ ‡πÄ‡∏ó‡∏û‡∏ß‡πà‡∏∞! ‡∏£‡∏≠‡∏î"; btn.style.background = "#00e676"; playSound(resultSound); }
    else { btn.innerText = "üíÄ ‡πÑ‡∏°‡πà‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô! ‡∏î‡∏∑‡πà‡∏°"; btn.style.background = "#ef5350"; playSound(alarmSound); }
    btn.disabled = true; spinBtn.disabled = false;
}
function setupRouletteGame() {
    window.bulletChamber = Math.floor(Math.random() * 6);
    window.currentChamber = 0;
    specialGameArea.innerHTML = `<div id="roulette-status" style="margin-bottom:10px;">‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà 1 / 6</div><button class="game-btn" id="trigger-btn" onclick="pullTrigger()">ü§û ‡πÄ‡∏´‡∏ô‡∏µ‡πà‡∏¢‡∏ß‡πÑ‡∏Å</button>${getSkipButtonHTML()}`;
}
function pullTrigger() {
    const btn = document.getElementById('trigger-btn');
    playSound(gunSound); btn.disabled = true;
    setTimeout(() => {
        if (window.currentChamber === window.bulletChamber) {
            playSound(bangSound);
            specialGameArea.innerHTML = `<div class="timer-text">üí•</div><div style="color:#ef5350; font-weight:bold;">‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡∏ß</div>${getSkipButtonHTML()}`;
            spinBtn.disabled = false;
        } else {
            playSound(clickSound); window.currentChamber++;
            btn.disabled = false;
            document.getElementById('roulette-status').innerText = `‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà ${window.currentChamber + 1} / 6 (‡∏£‡∏≠‡∏î...)`;
        }
    }, 600);
}
function setupBombGame() {
    const bombWire = Math.floor(Math.random() * 4);
    const colors = ["#ef5350", "#00e676", "#42a5f5", "#ffca28"];
    let wiresHTML = colors.map((color, i) => `<div class="wire-btn" style="background:${color}" onclick="cutWire(this, ${i === bombWire})"></div>`).join('');
    specialGameArea.innerHTML = `<div class="wire-container">${wiresHTML}</div>${getSkipButtonHTML()}`;
}
function cutWire(el, isBomb) {
    if (isBomb) {
        playSound(bangSound); 
        el.style.background = "#000"; el.style.boxShadow = "0 0 20px #ff3b3b"; el.innerText = "üí•";
        specialGameArea.style.animation = "shake 0.5s";
        setTimeout(() => { specialGameArea.style.animation = ""; }, 500);
        resultDisplay.innerText = "‡∏ö‡∏∂‡πâ‡∏°‡∏°‡∏°! ‡∏î‡∏∑‡πà‡∏°‡∏°‡∏°!";
        spinBtn.disabled = false;
        document.querySelectorAll('.wire-btn').forEach(b => { b.onclick = null; b.style.cursor = "default"; });
    } else {
        playSound(clickSound); el.style.opacity = "0.1"; el.style.pointerEvents = "none";
    }
}
function setupMemoryGame() {
    const num = Math.floor(10000 + Math.random() * 90000);
    specialGameArea.innerHTML = `<div style="font-size:0.9rem; margin-bottom:10px; color:#aaa;">‡∏à‡∏≥‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÉ‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ!</div><div class="timer-text" id="mem-num" style="color:#00e676;">${num}</div><div style="width:100%; height:6px; background:#333; border-radius:10px; overflow:hidden; margin-top:10px;"><div id="mem-progress" style="width:100%; height:100%; background:#00e676; transition: width 5s linear;"></div></div>`;
    setTimeout(() => { const progressBar = document.getElementById('mem-progress'); if(progressBar) progressBar.style.width = '0%'; }, 50);
    setTimeout(() => {
        const memNumDisplay = document.getElementById('mem-num');
        if (memNumDisplay) {
            specialGameArea.innerHTML = `<div style="font-size:1.1rem; margin-bottom:15px; font-weight:bold;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ‡πÄ‡∏•‡∏Ç‡∏≠‡∏∞‡πÑ‡∏£!?</div><input type="number" id="mem-input" autocomplete="off" placeholder="?" style="padding:15px; border-radius:12px; border:2px solid #00e676; width:90%; text-align:center; font-size:1.8rem; background:#000; color:#fff; margin-bottom:15px; outline:none;"><button class="game-btn" onclick="checkMemory(${num})" style="background:#00e676; color:#000;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>${getSkipButtonHTML()}`;
            document.getElementById('mem-input').focus();
        }
    }, 5000);
}
function checkMemory(correct) {
    const inputEl = document.getElementById('mem-input');
    const val = parseInt(inputEl.value);
    if (val === correct) { resultDisplay.innerText = "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏£‡∏≠‡∏î‡∏ï‡∏≤‡∏¢"; playSound(resultSound); }
    else { resultDisplay.innerText = `‡∏ú‡∏¥‡∏î! ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠ ${correct}`; playSound(alarmSound); }
    specialGameArea.innerHTML = getSkipButtonHTML(); spinBtn.disabled = false;
}

// --- ‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà 1: Clicker (‡∏£‡∏±‡∏ß‡∏ô‡∏¥‡πâ‡∏ß) ---
function setupClickerGame(target, time) {
    specialGameArea.innerHTML = `
        <div style="font-size:1rem; margin-bottom:5px;">‡∏Å‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ${target} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ${time} ‡∏ß‡∏¥</div>
        <button class="game-btn" onclick="startClicker(${target}, ${time})">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏£‡∏±‡∏ß‡∏ô‡∏¥‡πâ‡∏ß!</button>
        ${getSkipButtonHTML()}
    `;
}
function startClicker(target, time) {
    let count = 0;
    let isActive = true;
    
    specialGameArea.innerHTML = `
        <div class="timer-text" id="clicker-count" style="color:#fff">0</div>
        <div style="color:#aaa; margin-bottom:10px;">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: <span id="clicker-time">${time}</span> ‡∏ß‡∏¥</div>
        <button class="game-btn" id="click-btn" style="height:80px; font-size:1.5rem;" onclick="handleClicker(${target})">üî• ‡∏Å‡∏î!!!</button>
        ${getSkipButtonHTML()}
    `;

    // ‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
    let timeLeft = time;
    window.currentInterval = setInterval(() => {
        timeLeft--;
        const timeEl = document.getElementById('clicker-time');
        if(timeEl) timeEl.innerText = timeLeft;
        
        if (timeLeft <= 0) {
            clearInterval(window.currentInterval);
            isActive = false;
            document.getElementById('click-btn').disabled = true;
            if (count < target) {
                resultDisplay.innerText = "‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô! ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠...‡∏î‡∏∑‡πà‡∏°!";
                playSound(alarmSound);
            }
            spinBtn.disabled = false;
        }
    }, 1000);

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î
    window.handleClicker = (targetVal) => {
        if (!isActive) return;
        count++;
        document.getElementById('clicker-count').innerText = count;
        playSound(clickSound);
        
        if (count >= targetVal) {
            clearInterval(window.currentInterval);
            isActive = false;
            document.getElementById('click-btn').disabled = true;
            document.getElementById('click-btn').style.background = "#00e676";
            document.getElementById('click-btn').innerText = "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
            resultDisplay.innerText = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ô‡∏¥‡πâ‡∏ß‡∏£‡∏±‡∏ß‡∏°‡∏≤‡∏Å";
            playSound(resultSound);
            spinBtn.disabled = false;
        }
    };
}

// --- ‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà 2: High-Low (‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≥) ---
function setupHighLowGame() {
    const currentNum = Math.floor(Math.random() * 9) + 1; // 1-9
    specialGameArea.innerHTML = `
        <div style="color:#aaa; margin-bottom:5px;">‡πÄ‡∏•‡∏Ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠</div>
        <div class="timer-text" style="color:#fff;">${currentNum}</div>
        <div style="margin-bottom:15px; font-size:1.1rem;">‡∏ó‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏Ç‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (1-10) ‡∏à‡∏∞...</div>
        <div style="display:flex; gap:10px; width:100%;">
            <button class="game-btn" style="background:#42a5f5;" onclick="checkHighLow('low', ${currentNum})">‚¨áÔ∏è ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤</button>
            <button class="game-btn" style="background:#ef5350;" onclick="checkHighLow('high', ${currentNum})">‚¨ÜÔ∏è ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤</button>
        </div>
        ${getSkipButtonHTML()}
    `;
}
function checkHighLow(guess, prevNum) {
    let nextNum = Math.floor(Math.random() * 10) + 1; // 1-10
    
    // ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏Ç‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ú‡∏•‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏∞‡πÄ‡∏™‡∏°‡∏≠
    while(nextNum === prevNum) {
        nextNum = Math.floor(Math.random() * 10) + 1;
    }

    let isWin = false;
    if (guess === 'high' && nextNum > prevNum) isWin = true;
    if (guess === 'low' && nextNum < prevNum) isWin = true;

    let msg = isWin ? "‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ!" : "‡∏ú‡∏¥‡∏î! ‡∏î‡∏∑‡πà‡∏°‡∏ã‡∏∞";
    let color = isWin ? "#00e676" : "#ef5350";
    let sound = isWin ? resultSound : alarmSound;

    playSound(sound);

    specialGameArea.innerHTML = `
        <div style="font-size:1rem; color:#aaa;">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠...</div>
        <div class="timer-text" style="color:${color}; margin-bottom:5px;">${nextNum}</div>
        <div style="font-size:1.5rem; font-weight:bold; margin-bottom:10px;">${msg}</div>
        ${getSkipButtonHTML()}
    `;
    spinBtn.disabled = false;
}

// =================== Face AI Logic ===================
let smileInterval;
let gameTimerInterval;

async function setupSmileGame() {
    const overlay = document.getElementById('camera-overlay');
    const status = document.getElementById('smile-status');
    const timerDisplay = document.getElementById('smile-timer');
    const video = document.getElementById('camera-video');
    const backBtn = document.querySelector('.back-btn');
    
    overlay.style.display = 'flex';
    overlay.classList.remove("smile-detected");
    status.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏∏‡∏Å AI... (‡∏£‡∏≠‡πÅ‡∏õ‡πä‡∏ö)";
    status.style.color = "#fff";
    timerDisplay.innerText = "--";
    backBtn.style.display = 'none'; 

    try {
        let faceModelsLoaded = false;
        if (!faceModelsLoaded) {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
            await faceapi.nets.faceExpressionNet.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
            faceModelsLoaded = true;
        }

        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
        video.srcObject = stream;
        status.innerText = "‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°...";
        video.addEventListener('play', () => { startSmileDetection(video); });

    } catch (err) {
        console.error(err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏•‡πâ‡∏≠‡∏á)");
        closeCameraGame();
    }
}

function startSmileDetection(video) {
    const status = document.getElementById('smile-status');
    const timerDisplay = document.getElementById('smile-timer');
    const backBtn = document.querySelector('.back-btn');
    
    let timeLeft = 10;
    let gameStarted = false; 

    timerDisplay.innerText = "‡∏£‡∏≠‡∏´‡∏ô‡πâ‡∏≤..."; 
    clearInterval(gameTimerInterval);
    clearInterval(smileInterval);

    smileInterval = setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
        
        if (detections.length > 0) {
            if (!gameStarted) {
                gameStarted = true;
                status.innerText = "‡∏à‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß! ‡∏´‡πâ‡∏≤‡∏°‡∏¢‡∏¥‡πâ‡∏°!";
                status.style.color = "#ef5350";
                timerDisplay.innerText = timeLeft;

                gameTimerInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.innerText = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(gameTimerInterval);
                        clearInterval(smileInterval);
                        status.innerText = "üéâ ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ";
                        status.style.color = "#00e676";
                        playSound(resultSound);
                        backBtn.style.display = 'inline-block';
                    }
                }, 1000);
            }
            const happiness = detections[0].expressions.happy;
            if (happiness > 0.4) { 
                failSmileGame();
            }
        }
    }, 100);
}

function failSmileGame() {
    clearInterval(gameTimerInterval);
    clearInterval(smileInterval);
    const status = document.getElementById('smile-status');
    const overlay = document.getElementById('camera-overlay');
    const backBtn = document.querySelector('.back-btn');
    
    status.innerHTML = "üíÄ ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß! ‡∏¢‡∏¥‡πâ‡∏°‡∏ó‡∏≥‡πÑ‡∏°!<br>‡∏î‡∏∑‡πà‡∏°‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡∏ß!";
    status.style.color = "#ef5350";
    overlay.classList.add("smile-detected");
    playSound(alarmSound); 
    playSound(bangSound);
    backBtn.style.display = 'inline-block'; 
}

function closeCameraGame() {
    const overlay = document.getElementById('camera-overlay');
    const video = document.getElementById('camera-video');
    if (video.srcObject) video.srcObject.getTracks().forEach(track => track.stop());
    clearInterval(smileInterval);
    clearInterval(gameTimerInterval);
    overlay.style.display = 'none';
    specialGameArea.style.display = 'none'; 
    spinBtn.disabled = false; 
    resultDisplay.innerText = "‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏´‡∏°?";
}

// =================== History ===================
function openHistory() {
    playSound(clickSound); historyModal.classList.add('active');
    if (history.length === 0) { historyListDisplay.innerHTML = '<li style="text-align:center; padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</li>'; return; }
    historyListDisplay.innerHTML = history.map(h => `<li class="history-item"><span class="history-tag" style="background:${h.color}">${h.c}</span><span style="flex:1;">${h.t}</span></li>`).join("");
}
function closeHistory() { historyModal.classList.remove('active'); }
historyModal.addEventListener('click', (e) => { if (e.target === historyModal) closeHistory(); });
</script>
    
</body>
</html>
