<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro EXIF Card + Map & Time</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Roboto+Mono:wght@400;700&display=swap');

    :root {
        --bg-color: #020617;
        --card-bg: #1e293b;
        --accent: #38bdf8;
        --accent-secondary: #818cf8;
        --text-main: #f1f5f9;
        --text-dim: #94a3b8;
    }

    * { box-sizing: border-box; }
    body {
        font-family: 'Sarabun', sans-serif;
        background: var(--bg-color);
        color: var(--text-main);
        margin: 0; padding: 20px;
        display: flex; flex-direction: column; align-items: center;
    }

    .btn {
        border: 1px solid var(--accent); color: var(--accent);
        background: transparent; padding: 10px 24px; border-radius: 50px;
        font-size: 14px; font-weight: bold; cursor: pointer; transition: 0.3s;
        margin-bottom: 20px;
    }
    .btn:hover { background: var(--accent); color: #0f172a; }
    input[type=file] { display: none; }

    .capture-card {
        background: var(--card-bg);
        width: 100%; max-width: 400px; 
        border-radius: 24px; padding: 20px;
        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7);
        display: none; border: 1px solid rgba(255,255,255,0.1);
    }
    .capture-card.active { display: block; }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß: ‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á */
    .header { text-align: center; margin-bottom: 15px; }
    .cam-model { font-size: 18px; font-weight: 600; color: #fff; }
    .cam-lens { font-size: 11px; color: var(--accent); font-family: 'Roboto Mono'; opacity: 0.8; }

    /* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
    .visual-stack { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
    .img-box { 
        width: 100%; height: 220px; background: #000; 
        border-radius: 15px; overflow: hidden; border: 1px solid #333;
        display: flex; justify-content: center; align-items: center;
    }
    .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
    
    #map { width: 100%; height: 120px; border-radius: 15px; display: none; }

    /* ‡πÅ‡∏ñ‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (Highlight) */
    .info-bar {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 12px; padding: 12px;
        margin-bottom: 15px; border: 1px solid rgba(56, 189, 248, 0.2);
    }
    .loc-row { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; }
    .time-row { 
        display: flex; justify-content: space-between; align-items: center;
        padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);
    }
    .label-mini { font-size: 9px; color: var(--text-dim); text-transform: uppercase; }
    .val-mini { font-size: 12px; color: #fff; }
    .val-time { font-family: 'Roboto Mono'; font-size: 16px; color: var(--accent); font-weight: bold; }

    /* Stats Grid */
    .stats-grid {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
    }
    .stat-box {
        background: rgba(255,255,255,0.03); padding: 10px 5px;
        border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.05);
    }
    .stat-label { font-size: 9px; color: var(--text-dim); margin-bottom: 4px; }
    .stat-value { font-family: 'Roboto Mono'; font-size: 12px; color: var(--accent-secondary); font-weight: 700; }

    .footer { text-align: center; font-size: 9px; color: #475569; margin-top: 15px; letter-spacing: 2px; }
</style>
</head>
<body>

    <label for="upload" class="btn">üì∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
    <input type="file" accept="image/*" id="upload">

    <div class="capture-card" id="card">
        <div class="header">
            <div class="cam-model" id="camModel">Camera Loading...</div>
            <div class="cam-lens" id="camLens">-</div>
        </div>

        <div class="visual-stack">
            <div class="img-box"><img id="preview"></div>
            <div id="map"></div>
        </div>

        <div class="info-bar">
            <div class="loc-row">
                <span>üìç</span>
                <div>
                    <div class="label-mini">Location</div>
                    <div class="val-mini" id="addressVal">No GPS Data</div>
                </div>
            </div>
            <div class="time-row">
                <div>
                    <div class="label-mini">Date</div>
                    <div class="val-mini" id="valDate">-</div>
                </div>
                <div style="text-align: right;">
                    <div class="label-mini">Time Taken</div>
                    <div class="val-time" id="valTime">--:--:--</div>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box"><div class="stat-label">APERTURE</div><div class="stat-value" id="valF">-</div></div>
            <div class="stat-box"><div class="stat-label">SHUTTER</div><div class="stat-value" id="valS">-</div></div>
            <div class="stat-box"><div class="stat-label">ISO</div><div class="stat-value" id="valISO">-</div></div>
            <div class="stat-box"><div class="stat-label">FOCAL</div><div class="stat-value" id="valFL">-</div></div>
            <div class="stat-box"><div class="stat-label">W x H</div><div class="stat-value" id="valRes">-</div></div>
            <div class="stat-box"><div class="stat-label">EXPOSURE</div><div class="stat-value" id="valExp">0 ev</div></div>
        </div>

        <div class="footer">METADATA CAPTURE PRO</div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    let map = null;

    function convertDMSToDD(d, m, s, ref) {
        let dd = d + m/60 + s/3600;
        return (ref === "S" || ref === "W") ? dd * -1 : dd;
    }

    document.getElementById('upload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const img = document.getElementById('preview');
        const card = document.getElementById('card');
        
        img.src = URL.createObjectURL(file);
        card.classList.add('active');

        img.onload = function () {
            EXIF.getData(img, function () {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
                document.getElementById('camModel').textContent = EXIF.getTag(this, "Model") || "Smartphone";
                document.getElementById('camLens').textContent = EXIF.getTag(this, "LensModel") || "Built-in Lens";
                document.getElementById('valF').textContent = EXIF.getTag(this, "FNumber") ? "f/" + EXIF.getTag(this, "FNumber") : "-";
                
                let s = EXIF.getTag(this, "ExposureTime");
                document.getElementById('valS').textContent = s ? (s < 1 ? `1/${Math.round(1/s)}` : s) + "s" : "-";
                document.getElementById('valISO').textContent = EXIF.getTag(this, "ISOSpeedRatings") || "-";
                document.getElementById('valFL').textContent = (EXIF.getTag(this, "FocalLength") || "-") + "mm";
                document.getElementById('valRes').textContent = `${EXIF.getTag(this, "PixelXDimension") || 0}x${EXIF.getTag(this, "PixelYDimension") || 0}`;
                
                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "‡πÄ‡∏ß‡∏•‡∏≤" ‡πÅ‡∏•‡∏∞ "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"
                const dateTime = EXIF.getTag(this, "DateTimeOriginal");
                if (dateTime) {
                    const parts = dateTime.split(" "); // ["2023:10:25", "14:30:05"]
                    document.getElementById('valDate').textContent = parts[0].replace(/:/g, "/");
                    document.getElementById('valTime').textContent = parts[1];
                }

                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á GPS ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                const lat = EXIF.getTag(this, "GPSLatitude");
                const lng = EXIF.getTag(this, "GPSLongitude");
                if (lat && lng) {
                    const latDec = convertDMSToDD(lat[0], lat[1], lat[2], EXIF.getTag(this, "GPSLatitudeRef"));
                    const lngDec = convertDMSToDD(lng[0], lng[1], lng[2], EXIF.getTag(this, "GPSLongitudeRef"));
                    
                    document.getElementById('map').style.display = 'block';
                    if (!map) {
                        map = L.map('map', {zoomControl:false, attributionControl:false}).setView([latDec, lngDec], 14);
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
                    } else {
                        map.setView([latDec, lngDec], 14);
                    }
                    L.marker([latDec, lngDec]).addTo(map);
                    setTimeout(() => map.invalidateSize(), 400);

                    // ‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latDec}&lon=${lngDec}&accept-language=th`)
                        .then(res => res.json())
                        .then(data => {
                            const a = data.address;
                            document.getElementById('addressVal').textContent = `${a.suburb || a.district || ''} ${a.city || a.province || ''}`.trim();
                        });
                } else {
                    document.getElementById('map').style.display = 'none';
                    document.getElementById('addressVal').textContent = "No GPS Metadata Found";
                }
            });
        };
    });
</script>
</body>
</html>
