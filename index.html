<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro EXIF - Full Location</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Roboto+Mono:wght@400;700&display=swap');

    :root {
        --bg-color: #020617;
        --card-bg: #1e293b;
        --accent: #38bdf8;
        --text-main: #f1f5f9;
        --text-dim: #94a3b8;
    }

    * { box-sizing: border-box; }
    body {
        font-family: 'Sarabun', sans-serif;
        background: var(--bg-color);
        color: var(--text-main);
        margin: 0; padding: 15px;
        display: flex; flex-direction: column; align-items: center;
    }

    .btn {
        border: 1px solid var(--accent); color: var(--accent);
        background: transparent; padding: 10px 24px; border-radius: 50px;
        font-size: 14px; font-weight: bold; cursor: pointer; margin-bottom: 15px;
    }

    input[type=file] { display: none; }

    .capture-card {
        background: var(--card-bg);
        width: 100%; max-width: 380px; 
        border-radius: 20px; padding: 18px;
        box-shadow: 0 25px 50px rgba(0,0,0,0.8);
        display: none; border: 1px solid rgba(255,255,255,0.1);
    }
    .capture-card.active { display: block; }

    /* Model & Lens */
    .header { text-align: center; margin-bottom: 12px; }
    .cam-model { font-size: 16px; font-weight: 600; color: #fff; }
    .cam-lens { font-size: 11px; color: var(--accent); font-family: 'Roboto Mono'; }

    /* Visual Content */
    .visual-stack { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    .img-box { 
        width: 100%; height: 200px; background: #000; 
        border-radius: 12px; overflow: hidden; border: 1px solid #333;
        display: flex; justify-content: center; align-items: center;
    }
    .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
    #map { width: 100%; height: 100px; border-radius: 12px; display: none; }

    /* Detailed Location & Time */
    .detail-panel {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px; padding: 12px; margin-bottom: 12px;
        border-left: 4px solid var(--accent);
    }
    .loc-label { font-size: 10px; color: var(--accent); font-weight: bold; text-transform: uppercase; margin-bottom: 4px; }
    .loc-full-text { font-size: 13px; color: #fff; line-height: 1.4; margin-bottom: 8px; }
    
    .time-grid { display: grid; grid-template-columns: 1fr 1fr; border-top: 1px solid #334155; padding-top: 8px; }
    .time-val { font-family: 'Roboto Mono'; font-size: 14px; color: #fff; }

    /* Technical Stats */
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .stat-box {
        background: rgba(255,255,255,0.03); padding: 8px 4px;
        border-radius: 8px; text-align: center;
    }
    .stat-label { font-size: 8px; color: var(--text-dim); text-transform: uppercase; }
    .stat-value { font-family: 'Roboto Mono'; font-size: 11px; color: #fff; margin-top: 2px; }

    .footer { text-align: center; font-size: 9px; color: #475569; margin-top: 12px; letter-spacing: 1px; }
</style>
</head>
<body>

    <label for="upload" class="btn">üì∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
    <input type="file" accept="image/*" id="upload">

    <div class="capture-card" id="card">
        <div class="header">
            <div class="cam-model" id="camModel">-</div>
            <div class="cam-lens" id="camLens">-</div>
        </div>

        <div class="visual-stack">
            <div class="img-box"><img id="preview"></div>
            <div id="map"></div>
        </div>

        <div class="detail-panel">
            <div class="loc-label">üìç Location Details</div>
            <div class="loc-full-text" id="fullAddress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ö‡πâ‡∏≤‡∏ô, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...</div>
            
            <div class="time-grid">
                <div>
                    <div class="loc-label">üìÖ Date</div>
                    <div class="time-val" id="valDate">--/--/----</div>
                </div>
                <div style="text-align: right;">
                    <div class="loc-label">‚è∞ Time</div>
                    <div class="time-val" id="valTime" style="color: var(--accent);">--:--:--</div>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box"><div class="stat-label">Aperture</div><div class="stat-value" id="valF">-</div></div>
            <div class="stat-box"><div class="stat-label">Shutter</div><div class="stat-value" id="valS">-</div></div>
            <div class="stat-box"><div class="stat-label">ISO</div><div class="stat-value" id="valISO">-</div></div>
            <div class="stat-box"><div class="stat-label">Focal</div><div class="stat-value" id="valFL">-</div></div>
            <div class="stat-box"><div class="stat-label">Res</div><div class="stat-value" id="valRes">-</div></div>
            <div class="stat-box"><div class="stat-label">GPS</div><div class="stat-value" id="valGPS" style="font-size: 9px;">-</div></div>
        </div>

        <div class="footer">FULL LOCATION METADATA CARD</div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    let map = null;

    function convertDMSToDD(d, m, s, ref) {
        let dd = d + m/60 + s/3600;
        return (ref === "S" || ref === "W") ? dd * -1 : dd;
    }

    document.getElementById('upload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const img = document.getElementById('preview');
        const card = document.getElementById('card');
        img.src = URL.createObjectURL(file);
        card.classList.add('active');

        img.onload = function () {
            EXIF.getData(img, function () {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á
                document.getElementById('camModel').textContent = EXIF.getTag(this, "Model") || "Unknown Device";
                document.getElementById('camLens').textContent = EXIF.getTag(this, "LensModel") || "";
                document.getElementById('valF').textContent = EXIF.getTag(this, "FNumber") ? "f/" + EXIF.getTag(this, "FNumber") : "-";
                
                let s = EXIF.getTag(this, "ExposureTime");
                document.getElementById('valS').textContent = s ? (s < 1 ? `1/${Math.round(1/s)}` : s) + "s" : "-";
                document.getElementById('valISO').textContent = EXIF.getTag(this, "ISOSpeedRatings") || "-";
                document.getElementById('valFL').textContent = (EXIF.getTag(this, "FocalLength") || "-") + "mm";
                document.getElementById('valRes').textContent = `${EXIF.getTag(this, "PixelXDimension") || 0}x${EXIF.getTag(this, "PixelYDimension") || 0}`;
                
                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
                const dateTime = EXIF.getTag(this, "DateTimeOriginal");
                if (dateTime) {
                    const parts = dateTime.split(" ");
                    document.getElementById('valDate').textContent = parts[0].replace(/:/g, "/");
                    document.getElementById('valTime').textContent = parts[1];
                }

                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                const lat = EXIF.getTag(this, "GPSLatitude");
                const lng = EXIF.getTag(this, "GPSLongitude");
                
                if (lat && lng) {
                    const latDec = convertDMSToDD(lat[0], lat[1], lat[2], EXIF.getTag(this, "GPSLatitudeRef"));
                    const lngDec = convertDMSToDD(lng[0], lng[1], lng[2], EXIF.getTag(this, "GPSLongitudeRef"));
                    
                    document.getElementById('valGPS').textContent = `${latDec.toFixed(4)}, ${lngDec.toFixed(4)}`;
                    document.getElementById('map').style.display = 'block';

                    if (!map) {
                        map = L.map('map', {zoomControl:false, attributionControl:false}).setView([latDec, lngDec], 15);
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
                    } else {
                        map.setView([latDec, lngDec], 15);
                    }
                    L.marker([latDec, lngDec]).addTo(map);
                    setTimeout(() => map.invalidateSize(), 400);

                    // ‡∏î‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ‡∏ö‡πâ‡∏≤‡∏ô, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latDec}&lon=${lngDec}&accept-language=th`)
                        .then(res => res.json())
                        .then(data => {
                            const a = data.address;
                            let fullAddr = [];
                            
                            // ‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö: ‡∏ö‡πâ‡∏≤‡∏ô/‡∏ã‡∏≠‡∏¢ -> ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á -> ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï -> ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                            if (a.village || a.house_number || a.road) fullAddr.push(a.village || a.road || a.house_number);
                            if (a.suburb || a.subdistrict) fullAddr.push("‡∏ï." + (a.suburb || a.subdistrict));
                            if (a.city_district || a.district || a.town) fullAddr.push("‡∏≠." + (a.city_district || a.district || a.town));
                            if (a.province || a.state || a.city) fullAddr.push("‡∏à." + (a.province || a.state || a.city));

                            document.getElementById('fullAddress').textContent = fullAddr.join(' ') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô";
                        })
                        .catch(() => {
                            document.getElementById('fullAddress').textContent = "‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Check Internet)";
                        });
                } else {
                    document.getElementById('map').style.display = 'none';
                    document.getElementById('fullAddress').textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î (GPS) ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ";
                    document.getElementById('valGPS').textContent = "No Signal";
                }
            });
        };
    });
</script>
</body>
</html>
