<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro EXIF - Landscape Mode</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Roboto+Mono:wght@400;700&display=swap');

    :root {
        --bg-color: #0f172a;
        --card-bg: #1e293b;
        --accent: #38bdf8;
        --text-main: #f8fafc;
        --text-dim: #94a3b8;
        --border: rgba(255,255,255,0.1);
    }

    * { box-sizing: border-box; }
    body {
        font-family: 'Sarabun', sans-serif;
        background: var(--bg-color);
        color: var(--text-main);
        margin: 0; padding: 20px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        min-height: 100vh;
    }

    .btn {
        border: 1px solid var(--accent); color: var(--accent);
        background: rgba(56, 189, 248, 0.1); padding: 12px 30px; border-radius: 50px;
        font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 25px;
        transition: all 0.3s ease;
    }
    .btn:hover { background: var(--accent); color: #000; }

    input[type=file] { display: none; }

    /* --- Landscape Card Design --- */
    .capture-card {
        background: var(--card-bg);
        width: 100%; max-width: 900px; /* ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
        border-radius: 24px; padding: 25px;
        box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        display: none; border: 1px solid var(--border);
        
        /* Grid Layout: 2 Columns */
        grid-template-columns: 1.2fr 1fr; 
        gap: 25px;
    }
    .capture-card.active { display: grid; }

    /* Left Column: Visuals */
    .col-visual { display: flex; flex-direction: column; gap: 15px; }
    
    .img-box { 
        width: 100%; height: 280px; background: #000; 
        border-radius: 16px; overflow: hidden; border: 1px solid #333;
        display: flex; justify-content: center; align-items: center;
        position: relative;
    }
    .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
    
    #map { 
        width: 100%; height: 140px; border-radius: 16px; 
        border: 1px solid #333; z-index: 1;
    }

    /* Right Column: Info */
    .col-info { display: flex; flex-direction: column; justify-content: space-between; }

    .header-group { border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 15px; }
    .cam-model { font-size: 24px; font-weight: 700; color: #fff; line-height: 1.2; }
    .cam-lens { font-size: 13px; color: var(--accent); font-family: 'Roboto Mono'; margin-top: 4px; }

    .location-group { margin-bottom: 15px; }
    .label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 5px; }
    .full-address { 
        font-size: 16px; color: #fff; line-height: 1.5; 
        background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px;
        min-height: 60px;
    }

    .time-group { 
        display: flex; gap: 20px; margin-bottom: 20px; 
        background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;
    }
    .time-box { flex: 1; }
    .time-val { font-family: 'Roboto Mono'; font-size: 18px; color: var(--accent); font-weight: bold; }
    .date-val { font-family: 'Roboto Mono'; font-size: 16px; color: #fff; }

    /* Stats Grid */
    .stats-grid { 
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; 
    }
    .stat-box {
        background: rgba(255,255,255,0.05); padding: 10px 5px;
        border-radius: 10px; text-align: center;
        border: 1px solid rgba(255,255,255,0.05);
    }
    .stat-label { font-size: 9px; color: var(--text-dim); text-transform: uppercase; }
    .stat-value { font-family: 'Roboto Mono'; font-size: 13px; color: #fff; margin-top: 4px; font-weight: 600; }

    .gps-coords {
        grid-column: span 3; /* ‡πÉ‡∏´‡πâ GPS ‡∏¢‡∏≤‡∏ß‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏ñ‡∏ß */
        background: transparent; border: 1px dashed var(--border);
        color: var(--text-dim); font-size: 10px;
    }

    .footer-credit {
        position: fixed; bottom: 10px; right: 10px; 
        font-size: 10px; color: #334155; opacity: 0.5;
    }
</style>
</head>
<body>

    <label for="upload" class="btn">üì∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Landscape)</label>
    <input type="file" accept="image/*" id="upload">

    <div class="capture-card" id="card">
        <div class="col-visual">
            <div class="img-box"><img id="preview" src=""></div>
            <div id="map"></div>
        </div>

        <div class="col-info">
            <div>
                <div class="header-group">
                    <div class="cam-model" id="camModel">Loading...</div>
                    <div class="cam-lens" id="camLens">...</div>
                </div>

                <div class="location-group">
                    <div class="label">üìç LOCATION</div>
                    <div class="full-address" id="fullAddress">‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                </div>

                <div class="time-group">
                    <div class="time-box">
                        <div class="label">üìÖ DATE</div>
                        <div class="date-val" id="valDate">--/--/----</div>
                    </div>
                    <div class="time-box" style="text-align: right;">
                        <div class="label">‚è∞ TIME</div>
                        <div class="time-val" id="valTime">--:--</div>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box"><div class="stat-label">Aperture</div><div class="stat-value" id="valF">-</div></div>
                <div class="stat-box"><div class="stat-label">Shutter</div><div class="stat-value" id="valS">-</div></div>
                <div class="stat-box"><div class="stat-label">ISO</div><div class="stat-value" id="valISO">-</div></div>
                <div class="stat-box"><div class="stat-label">Focal Length</div><div class="stat-value" id="valFL">-</div></div>
                <div class="stat-box"><div class="stat-label">Resolution</div><div class="stat-value" id="valRes">-</div></div>
                <div class="stat-box"><div class="stat-label">Flash</div><div class="stat-value" id="valFlash">-</div></div>
                <div class="stat-box gps-coords"><div class="stat-value" id="valGPS" style="font-size: 10px; margin:0;">NO GPS DATA</div></div>
            </div>
        </div>
    </div>
    
    <div class="footer-credit">Exif Viewer Pro</div>

<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    let map = null;
    let marker = null;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
    function resetData() {
        document.getElementById('camModel').textContent = "Analyzing...";
        document.getElementById('camLens').textContent = "...";
        document.getElementById('fullAddress').textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...";
        document.getElementById('valDate').textContent = "--/--/----";
        document.getElementById('valTime').textContent = "--:--";
        document.getElementById('valF').textContent = "-";
        document.getElementById('valS').textContent = "-";
        document.getElementById('valISO').textContent = "-";
        document.getElementById('valFL').textContent = "-";
        document.getElementById('valRes').textContent = "-";
        document.getElementById('valFlash').textContent = "-";
        document.getElementById('valGPS').textContent = "NO GPS DATA";
        
        // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï marker
        if (map && marker) {
            map.removeLayer(marker);
            marker = null;
        }
    }

    function convertDMSToDD(d, m, s, ref) {
        let dd = d + m/60 + s/3600;
        return (ref === "S" || ref === "W") ? dd * -1 : dd;
    }

    document.getElementById('upload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;

        resetData(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤

        const img = document.getElementById('preview');
        const card = document.getElementById('card');
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
        const objectUrl = URL.createObjectURL(file);
        img.src = objectUrl;
        
        card.classList.add('active');

        img.onload = function () {
            // ‡∏Ñ‡∏∑‡∏ô memory ‡∏Ç‡∏≠‡∏á url ‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            // URL.revokeObjectURL(objectUrl); 

            EXIF.getData(img, function () {
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡πâ‡∏≠‡∏á
                let make = EXIF.getTag(this, "Make") || "";
                let model = EXIF.getTag(this, "Model") || "Unknown Camera";
                // ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ã‡πâ‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô "Apple iPhone 13" -> "iPhone 13" ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                if(model.includes(make)) make = "";
                document.getElementById('camModel').textContent = `${make} ${model}`.trim();
                
                document.getElementById('camLens').textContent = EXIF.getTag(this, "LensModel") || "Lens info not found";

                // ‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
                document.getElementById('valF').textContent = EXIF.getTag(this, "FNumber") ? "f/" + EXIF.getTag(this, "FNumber") : "-";
                
                let s = EXIF.getTag(this, "ExposureTime");
                document.getElementById('valS').textContent = s ? (s < 1 ? `1/${Math.round(1/s)}` : s) + "s" : "-";
                
                document.getElementById('valISO').textContent = EXIF.getTag(this, "ISOSpeedRatings") || "-";
                document.getElementById('valFL').textContent = (EXIF.getTag(this, "FocalLength") || "-") + "mm";
                document.getElementById('valRes').textContent = `${EXIF.getTag(this, "PixelXDimension") || 0}x${EXIF.getTag(this, "PixelYDimension") || 0}`;
                
                let flash = EXIF.getTag(this, "Flash");
                document.getElementById('valFlash').textContent = flash ? "On" : "Off"; // ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠

                // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                const dateTime = EXIF.getTag(this, "DateTimeOriginal");
                if (dateTime) {
                    const parts = dateTime.split(" ");
                    document.getElementById('valDate').textContent = parts[0].replace(/:/g, "/");
                    document.getElementById('valTime').textContent = parts[1].substring(0, 5); // ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà HH:mm
                }

                // ‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS
                const latTag = EXIF.getTag(this, "GPSLatitude");
                const lngTag = EXIF.getTag(this, "GPSLongitude");
                
                if (latTag && lngTag) {
                    const latDec = convertDMSToDD(latTag[0], latTag[1], latTag[2], EXIF.getTag(this, "GPSLatitudeRef"));
                    const lngDec = convertDMSToDD(lngTag[0], lngTag[1], lngTag[2], EXIF.getTag(this, "GPSLongitudeRef"));
                    
                    document.getElementById('valGPS').textContent = `${latDec.toFixed(5)}, ${lngDec.toFixed(5)}`;
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                    if (!map) {
                        map = L.map('map', {zoomControl:false, attributionControl:false});
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                            maxZoom: 19
                        }).addTo(map);
                    }
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                    map.setView([latDec, lngDec], 15);
                    
                    // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
                    if(marker) map.removeLayer(marker); // ‡∏•‡∏ö‡∏≠‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ä‡∏±‡∏ß‡∏£‡πå‡πÜ ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
                    marker = L.marker([latDec, lngDec]).addTo(map);

                    // ‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°
                    setTimeout(() => { map.invalidateSize(); }, 300);

                    // ‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latDec}&lon=${lngDec}&accept-language=th`)
                        .then(res => res.json())
                        .then(data => {
                            const a = data.address;
                            let parts = [];
                            
                            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
                            if (a.village) parts.push("‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô" + a.village);
                            if (a.road) parts.push("‡∏ñ." + a.road);
                            if (a.suburb || a.subdistrict || a.neighbourhood) parts.push(a.suburb || a.subdistrict || a.neighbourhood);
                            if (a.city_district || a.district) parts.push(a.city_district || a.district);
                            if (a.province || a.state) parts.push("‡∏à." + (a.province || a.state));
                            
                            // ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ display_name ‡πÅ‡∏ó‡∏ô
                            let finalAddr = parts.length > 0 ? parts.join(", ") : (data.display_name || "‡∏û‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
                            document.getElementById('fullAddress').textContent = finalAddr;
                        })
                        .catch(err => {
                            document.getElementById('fullAddress').textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ";
                        });

                } else {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ GPS
                    document.getElementById('fullAddress').textContent = "‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡∏ù‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà";
                    document.getElementById('valGPS').textContent = "NO GPS DATA";
                    if(map) {
                         map.setView([13.7563, 100.5018], 5); // Default Bangkok
                         if(marker) map.removeLayer(marker);
                    }
                }
            });
        };
    });
</script>
</body>
</html>
