<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÄ‡∏£‡πá‡∏ß!</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
    #game { margin-top: 50px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>üéÆ ‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÄ‡∏£‡πá‡∏ß!</h1>
  <div id="game">
    <input id="roomId" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô room1)">
    <button id="createRoom">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
    <button id="joinRoom">‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</button>
    <p id="status"></p>
    <div id="wordArea" style="display:none;">
      <h2 id="wordToGuess"></h2>
      <input id="guessInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...">
      <button id="submitGuess">‡∏ï‡∏≠‡∏ö</button>
      <p id="result"></p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcxVAP08XMiPMoqElaKM7AYY_2z08oWok",
      authDomain: "xobybestry777.firebaseapp.com",
      projectId: "xobybestry777",
      storageBucket: "xobybestry777.firebasestorage.app",
      messagingSenderId: "380539937989",
      appId: "1:380539937989:web:48049ed77f45327e033cac",
      measurementId: "G-YZWTKXL285"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const createBtn = document.getElementById("createRoom");
    const joinBtn = document.getElementById("joinRoom");
    const statusEl = document.getElementById("status");
    const wordArea = document.getElementById("wordArea");
    const wordEl = document.getElementById("wordToGuess");
    const guessInput = document.getElementById("guessInput");
    const resultEl = document.getElementById("result");
    const submitGuess = document.getElementById("submitGuess");

    let currentPlayer = "player" + Math.floor(Math.random() * 1000);
    let roomRef;

    const words = ["‡πÅ‡∏°‡∏ß", "‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", "‡πÇ‡∏ï‡πä‡∏∞", "‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ"];

    createBtn.onclick = async () => {
      const roomId = document.getElementById("roomId").value;
      const randomWord = words[Math.floor(Math.random() * words.length)];
      roomRef = doc(db, "rooms", roomId);
      await setDoc(roomRef, {
        players: [currentPlayer],
        currentWord: randomWord,
        guessed: ""
      });
      statusEl.textContent = "‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°...";
      startListening();
    };

    joinBtn.onclick = async () => {
      const roomId = document.getElementById("roomId").value;
      roomRef = doc(db, "rooms", roomId);
      const docSnap = await getDoc(roomRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        data.players.push(currentPlayer);
        await updateDoc(roomRef, { players: data.players });
        statusEl.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
        startListening();
      } else {
        statusEl.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ!";
      }
    };

    function startListening() {
      onSnapshot(roomRef, (snapshot) => {
        const data = snapshot.data();
        if (data.players.length >= 2) {
          statusEl.textContent = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!";
          wordArea.style.display = "block";
          wordEl.textContent = "‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥: " + data.currentWord[0] + " _ _";
        }
        if (data.guessed === data.currentWord) {
          resultEl.textContent = "üéâ ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß!";
        }
      });
    }

    submitGuess.onclick = async () => {
      const guess = guessInput.value.trim();
      const docSnap = await getDoc(roomRef);
      const data = docSnap.data();
      if (guess === data.currentWord) {
        await updateDoc(roomRef, { guessed: guess });
      } else {
        resultEl.textContent = "‡∏ú‡∏¥‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
      }
    };
  </script>
</body>
</html>
