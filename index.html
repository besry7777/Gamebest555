<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro EXIF Card + Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Roboto+Mono:wght@400;700&display=swap');

    :root {
        --bg-color: #0f172a;
        --card-bg: #1e293b;
        --accent: #38bdf8;
        --text-main: #f1f5f9;
        --text-dim: #94a3b8;
    }

    * { box-sizing: border-box; }

    body {
        font-family: 'Sarabun', sans-serif;
        background: var(--bg-color);
        color: var(--text-main);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° Upload */
    .upload-section { margin-bottom: 20px; text-align: center; }
    .btn {
        border: 1px solid var(--accent);
        color: var(--accent);
        background: transparent;
        padding: 10px 24px;
        border-radius: 50px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    .btn:hover { background: var(--accent); color: #0f172a; box-shadow: 0 0 15px rgba(56, 189, 248, 0.4); }
    input[type=file] { display: none; }

    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏Å */
    .capture-card {
        background: var(--card-bg);
        border: 1px solid rgba(255,255,255,0.1);
        width: 100%;
        max-width: 400px; 
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        display: none;
        position: relative;
        overflow: hidden;
    }
    .capture-card.active { display: block; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

    @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á) */
    .header-info {
        text-align: center;
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 10px;
    }
    .cam-model { font-size: 18px; font-weight: 600; color: #fff; letter-spacing: 0.5px; }
    .cam-lens { font-size: 12px; color: var(--accent); margin-top: 4px; font-family: 'Roboto Mono'; }

    /* Layout ‡∏£‡∏π‡∏õ + ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
    .visual-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .img-box {
        width: 100%;
        height: 180px;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #333;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

    /* ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
    #map {
        width: 100%;
        height: 150px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.1);
        z-index: 1;
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà */
    .location-text {
        text-align: center;
        font-size: 12px;
        color: #fff;
        margin-bottom: 15px;
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        background: rgba(56, 189, 248, 0.1);
        padding: 8px;
        border-radius: 8px;
        border: 1px dashed rgba(56, 189, 248, 0.3);
    }
    .location-icon { margin-right: 5px; }

    /* Grid ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 15px;
    }
    .stat-box {
        background: rgba(255,255,255,0.03);
        padding: 8px;
        border-radius: 8px;
        text-align: center;
    }
    .stat-label { font-size: 9px; color: var(--text-dim); text-transform: uppercase; }
    .stat-value { font-family: 'Roboto Mono'; font-size: 12px; font-weight: 700; color: var(--accent); margin-top: 4px; }

    /* Footer */
    .footer-credit {
        text-align: center;
        font-size: 9px;
        color: #444;
        margin-top: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Marker ‡∏Ç‡∏≠‡∏á Leaflet ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° */
    .leaflet-bar a { background-color: #1e293b !important; color: #fff !important; border-bottom: 1px solid #333 !important; }
</style>
</head>
<body>

    <div class="upload-section">
        <label for="upload" class="btn">
            <span>üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
        </label>
        <input type="file" accept="image/*" id="upload">
    </div>

    <div class="capture-card" id="card">
        <div class="header-info">
            <div class="cam-model" id="camModel">Unknown Camera</div>
            <div class="cam-lens" id="camLens">-</div>
        </div>

        <div class="visual-grid">
            <div class="img-box">
                <img id="preview" src="" alt="">
            </div>
            <div id="map"></div>
        </div>

        <div class="location-text" id="locText">
            <span class="location-icon">üìç</span> <span id="addressVal">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</span>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Aperture</div>
                <div class="stat-value" id="valF">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Shutter</div>
                <div class="stat-value" id="valS">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ISO</div>
                <div class="stat-value" id="valISO">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Focal Length</div>
                <div class="stat-value" id="valFL">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Date</div>
                <div class="stat-value" id="valDate">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Resolution</div>
                <div class="stat-value" id="valRes">-</div>
            </div>
        </div>

        <div class="footer-credit">EXIF & LOCATION VIEWER</div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    let map = null;

    // Helper: ‡πÅ‡∏õ‡∏•‡∏á DMS (Degree Minute Second) ‡πÄ‡∏õ‡πá‡∏ô Decimal
    function convertDMSToDD(degrees, minutes, seconds, direction) {
        let dd = degrees + minutes/60 + seconds/(60*60);
        if (direction == "S" || direction == "W") {
            dd = dd * -1;
        } 
        return dd;
    }

    document.getElementById('upload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const img = document.getElementById('preview');
        const card = document.getElementById('card');
        const mapDiv = document.getElementById('map');
        const locText = document.getElementById('locText');
        
        img.src = URL.createObjectURL(file);
        card.classList.add('active');

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤
        mapDiv.style.display = 'none';
        locText.style.display = 'none';
        document.getElementById('addressVal').textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...";

        img.onload = function () {
            EXIF.getData(img, function () {
                // 1. Basic Stats
                const make = EXIF.getTag(this, "Make") || "";
                const model = EXIF.getTag(this, "Model") || "Unknown Device";
                document.getElementById('camModel').textContent = `${make} ${model}`.trim();
                document.getElementById('camLens').textContent = EXIF.getTag(this, "LensModel") || EXIF.getTag(this, "Undefined") || "Standard Lens";

                document.getElementById('valF').textContent = "f/" + (EXIF.getTag(this, "FNumber") || "-");
                let shutter = EXIF.getTag(this, "ExposureTime");
                if(shutter && shutter < 1) shutter = "1/" + Math.round(1/shutter);
                document.getElementById('valS').textContent = shutter || "-";
                document.getElementById('valISO').textContent = EXIF.getTag(this, "ISOSpeedRatings") || "-";
                document.getElementById('valFL').textContent = (EXIF.getTag(this, "FocalLength") || "-") + "mm";
                
                const date = EXIF.getTag(this, "DateTimeOriginal");
                document.getElementById('valDate').textContent = date ? date.split(' ')[0].replace(/:/g, '/') : "-";
                
                const w = EXIF.getTag(this, "PixelXDimension");
                const h = EXIF.getTag(this, "PixelYDimension");
                document.getElementById('valRes').textContent = (w && h) ? `${w}x${h}` : "-";

                // 2. GPS & Map Logic
                const lat = EXIF.getTag(this, "GPSLatitude");
                const latRef = EXIF.getTag(this, "GPSLatitudeRef");
                const lng = EXIF.getTag(this, "GPSLongitude");
                const lngRef = EXIF.getTag(this, "GPSLongitudeRef");

                if (lat && lng && latRef && lngRef) {
                    // ‡πÅ‡∏õ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î
                    const latDec = convertDMSToDD(lat[0], lat[1], lat[2], latRef);
                    const lngDec = convertDMSToDD(lng[0], lng[1], lng[2], lngRef);

                    // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                    mapDiv.style.display = 'block';
                    locText.style.display = 'block';

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Leaflet) ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
                    if (!map) {
                        map = L.map('map', { zoomControl: false, attributionControl: false }).setView([latDec, lngDec], 13);
                        
                        // ‡πÉ‡∏ä‡πâ Dark Theme Map Tiles (CartoDB Dark Matter)
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                            maxZoom: 19
                        }).addTo(map);
                    } else {
                        map.setView([latDec, lngDec], 13);
                        map.eachLayer((layer) => {
                            if (layer instanceof L.Marker) { map.removeLayer(layer); }
                        });
                    }

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Marker
                    L.marker([latDec, lngDec]).addTo(map);
                    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Map ‡πÉ‡∏´‡πâ render ‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å map ‡πÄ‡∏ó‡∏≤)
                    setTimeout(() => { map.invalidateSize(); }, 300);

                    // 3. Reverse Geocoding (‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latDec}&lon=${lngDec}&accept-language=th`)
                        .then(response => response.json())
                        .then(data => {
                            const addr = data.address;
                            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                            const parts = [];
                            if (addr.village) parts.push(addr.village);
                            if (addr.suburb) parts.push(addr.suburb);
                            if (addr.city_district) parts.push(addr.city_district);
                            if (addr.city || addr.town || addr.county) parts.push(addr.city || addr.town || addr.county);
                            if (addr.state) parts.push(addr.state);

                            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                            const fullAddr = [...new Set(parts)].join(', ');
                            document.getElementById('addressVal').textContent = fullAddr || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà";
                        })
                        .catch(err => {
                            document.getElementById('addressVal').textContent = "‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
                        });

                } else {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ GPS
                    document.getElementById('addressVal').textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GPS ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ";
                    locText.style.display = 'block';
                }
            });
        };
    });
</script>

</body>
</html>
